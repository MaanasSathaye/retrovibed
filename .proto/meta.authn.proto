syntax = "proto3";

package meta;

import "meta.account.proto";
import "meta.profile.proto";

// options during login
message LoginOptions {
  // lock in the id of the login options.
  string id = 1 [ json_name = "id" ];
  // lock into a specific account. determined by the domain url.
  string account_id = 2 [ json_name = "account_id" ];
  // auto associate the identity with the specific profile.
  // this field is only populated by an otp options generated by an
  // authenticated user.
  string profile_id = 3 [ json_name = "profile_id" ];
  // represented by a jwt encoded url.
  string redirect = 4 [ json_name = "redirect" ];
  // enable autologin.
  bool autologin = 5 [ json_name = "autologin" ];
}

message LoginOptionsResponse {
  string token = 1
      [ json_name = "token" ]; // jwt signed token representing options
}

message Identity {
  string id = 1 [ json_name = "id" ];
  string display = 2 [ json_name = "display" ];
  string email = 4 [ json_name = "email" ];
  string uid = 7 [ json_name = "uid" ];
  string uidraw = 8 [ json_name = "uidraw" ];
}

message Authn {
  string token = 1 [ json_name = "token" ];
  Profile profile = 2 [ json_name = "profile" ];
  Account account = 3 [ json_name = "account" ];
}

message Authed {
  string signup_token = 1 [ json_name = "signup_token" ];
  Identity identity = 3 [ json_name = "identity" ];
  repeated Authn profiles = 4 [ json_name = "profiles" ];
  LoginOptions options = 5 [ json_name = "opts" ];
}

message Session {
  string token = 1 [ json_name = "token" ];
  Profile profile = 2 [ json_name = "profile" ];
  Account account = 3 [ json_name = "account" ];
  int64 expires = 4 [json_name = "expires" ];
  string redirect = 5 [ json_name = "redirect" ];
}
